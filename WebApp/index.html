<!DOCTYPE html>
<html>
<head>
    <title>Login/Register</title>
    <meta charset="UTF-8">

    <!-- JQuery -->
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>

    <!-- Bootstrap -->
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css"
          rel="stylesheet">

    <!--  Custom style -->
    <link href="resources/login.css" rel="stylesheet">
</head>

<body>

<div id="welcome_page_background">
    <div id="login_div">
        <h3> Login/Register</h3>
        <form id="login" class="form-signin" >
            <input id="loginEmail" class="form-control" placeholder="E-mail" style="margin-top:2px;">
            <input id="loginPassword" class="form-control" type="password" placeholder="Password" style="margin-top:2px;">
        </form>

        <form id="register" class="form-signin" style="display: none;">
            <input id="firstname" class="form-control" placeholder="First name" name="first_name" style="margin-top:2px;">
            <p class="help-block">Please enter your first name</p>
            <input id="lastname" class="form-control" placeholder="Last name" name="last_name" style="margin-top:2px;">
            <p class="help-block">Please enter your last name</p>
            <input id="registerEmail" class="form-control" placeholder="E-mail" name="email" style="margin-top:2px;">
            <p class="help-block">Enter any valid e-mail</p>
            <input id="registerPassword" class="form-control" type="password" name = "password" placeholder="Password" style="margin-top:2px;">
            <p class="help-block">Password length should be more than 6 symbols</p>
            <input id="registerPasswordConfirm" class="form-control" type="password" name = "password" placeholder="Password" style="margin-top:2px;">
            <p class="help-block">Passwords should match</p>
        </form>
        <button id = "submitButton" class="btn btn-lg btn-primary btn-block" type="button" style="margin-top: 5px">Login</button>
        <div id = "switcher_div">
            <a href="#" id="switcher"> Register </a>
        </div>
    </div>
</div>

</body>

</html>

<script>
    const form_modes = ["Register", "Login"];
    const form_display_mode = ["none", "block"];
    const LOGIN = 0;
    const REGISTER = 1;

    var current_mode = LOGIN;

    $("#switcher").click(function() {
        $("#login").css("display", form_display_mode[current_mode]);
        $("#register").css("display", form_display_mode[current_mode ^ 1]);
        $("#submitButton").text(form_modes[current_mode]);
        $("#switcher").text(form_modes[current_mode ^ 1]);
        current_mode ^= 1;
    })

    function sendAuthorizeRequest(url, params) {
        $.ajax ({
            type: "POST",
            url: url,
            contentType: 'application/json',
            async: false,
            data: JSON.stringify(params),
            success: function (response) {
                //...
            }
        })
    }

    function validAuthorizeParams(params) {
        if ("username" in params) {
            if (params["username"].search("@") == -1 || params["username"].length > 30)
                return false;
            return email.match(/^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/);
        }

        if ("password" in params) {
            if (params["password"].length > 30)
                return false;
        }
        if ("firstname" in params) {
            if (params["firstname"].length > 30)
                return false;
        }
        if ("lastname" in params) {
            if (params["lastname"].length > 30)
                return false;
        }

        return true;
    }

    $("#submitButton").click(function() {
        var url;
        var params = {};
        if (current_mode == LOGIN) {
            params("username", $("#loginEmail").val());
            params("password", $("#loginPassword").val());
            if (validAuthorizeParams(params)) {
                sendAuthorizeRequest("login_url", params);
            } else {

            }
        } else {
            params("firstname", $("#firstname").val());
            params("lastname", $("#lastname").val());
            params("username", $("#registerEmail").val());
            params("password", $("#registerPassword").val());
            if (validAuthorizeParams(params)) {
                sendAuthorizeRequest("register_url", params);
            } else {

            }
        }
    })
</script>